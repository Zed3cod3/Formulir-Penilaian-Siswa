<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form Penilaian Siswa</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
     <style>
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #3498db, #8e44ad);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            max-width: 1000px;
            width: 100%;
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #3498db;
            display: flex;
            flex-direction: column;
            align-items: center;
        }


        .logo img {
            width: 30%;
            height: 30%;
            object-fit: contain;
            padding: 10px;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            margin-top: 0;
            font-size: 1.8em;
        }

        .description {
            color: #7f8c8d;
            font-size: 1em;
            max-width: 600px;
        }

        .section {
            margin-bottom: 25px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            background-color: #f9f9f9;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }

        .section-title {
            font-size: 1.3em;
            color: #3498db;
            margin-top: 0;
            padding-bottom: 10px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            align-items: center;
        }

        .section-title i {
            margin-right: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #34495e;
        }

        input[type="text"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        select:focus,
        textarea:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }

        /* Menghilangkan spinner pada input number */
        input[type="number"] {
            -moz-appearance: textfield;
            max-width: 120px;
        }

        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        textarea {
            min-height: 120px;
            resize: vertical;
        }

        .rating-container {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .rating-item {
            flex: 1;
            min-width: 200px;
        }

        .btn-container {
            text-align: center;
            margin-top: 30px;
        }

        button {
            background: linear-gradient(to right, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 15px 35px;
            font-size: 18px;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }

        button:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .required {
            color: #e74c3c;
        }

        .input-hint {
            font-size: 0.85em;
            color: #7f8c8d;
            margin-top: 5px;
        }

        /* Gaya untuk ekstrakurikuler */
        .ekstra-container {
            margin-bottom: 15px;
        }

        .ekstra-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            background-color: #f0f8ff;
            border-radius: 6px;
            border: 1px solid #d1e7ff;
        }

        .ekstra-checkbox {
            margin-right: 10px;
            transform: scale(1.2);
        }

        .ekstra-label {
            flex: 1;
            font-weight: 500;
        }

        /* Notifikasi */
        .notification {
            padding: 15px 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            font-weight: 500;
            display: none;
        }

        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* Loading Indicator di tengah halaman */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .loading-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            max-width: 300px;
            width: 90%;
        }

        .loading-content i {
            font-size: 40px;
            color: #3498db;
            margin-bottom: 15px;
            animation: spin 1s linear infinite;
        }

        .loading-content p {
            margin: 0;
            font-size: 16px;
            color: #2c3e50;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .rating-container {
                flex-direction: column;
                gap: 10px;
            }

            .rating-item {
                min-width: 100%;
            }

            .container {
                padding: 20px;
            }

            .ekstra-item {
                flex-direction: column;
                align-items: flex-start;
            }

            .logo {
                width: 100px;
                height: 100px;
            }

            h1 {
                font-size: 1.5em;
            }

            .description {
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay di tengah halaman -->
    <div id="loadingIndicator" class="loading-overlay">
        <div class="loading-content">
            <i class="fas fa-spinner"></i>
            <p>Menyimpan data, harap tunggu...</p>
        </div>
    </div>
    
    <div class="container">
        <div class="header">
            <div class="logo-container">
                <div class="logo">
                    <img src="img/spenduga.jpg" alt="Logo SMP Negeri 23 Balikpapan">
                </div>
            </div>
            
            <h1>Form Penilaian Siswa</h1>
            <p class="description">Formulir penilaian perkembangan siswa SMP Negeri 23 Balikpapan</p>
        </div>
        
        <!-- Notifikasi -->
        <div id="successMessage" class="notification success">
            <i class="fas fa-check-circle"></i> <span id="successText">Penilaian berhasil disimpan!</span>
        </div>
        
        <div id="errorMessage" class="notification error">
            <i class="fas fa-exclamation-circle"></i> <span id="errorText">Terjadi kesalahan!</span>
        </div>
        
        <form id="evaluationForm">
            <!-- Data Siswa -->
            <div class="section">
                <h2 class="section-title"><i class="fas fa-user-graduate"></i> Data Siswa</h2>
                <div class="form-group">
                    <label for="nama">Nama Siswa: <span class="required">*</span></label>
                    <input type="text" id="nama" name="nama" required>
                </div>
                <div class="form-group">
                    <label for="kelas">Kelas: <span class="required">*</span></label>
                    <select id="kelas" name="kelas" required>
                        <option value="">Pilih Kelas</option>
                        <optgroup label="Kelas VII">
                            <option value="VII-A">VII-A</option>
                            <option value="VII-B">VII-B</option>
                            <option value="VII-C">VII-C</option>
                            <option value="VII-D">VII-D</option>
                            <option value="VII-E">VII-E</option>
                            <option value="VII-F">VII-F</option>
                        </optgroup>
                        <optgroup label="Kelas VIII">
                            <option value="VIII-A">VIII-A</option>
                            <option value="VIII-B">VIII-B</option>
                            <option value="VIII-C">VIII-C</option>
                            <option value="VIII-D">VIII-D</option>
                            <option value="VIII-E">VIII-E</option>
                            <option value="VIII-F">VIII-F</option>
                        </optgroup>
                        <optgroup label="Kelas IX">
                            <option value="IX-A">IX-A</option>
                            <option value="IX-B">IX-B</option>
                            <option value="IX-C">IX-C</option>
                            <option value="IX-D">IX-D</option>
                            <option value="IX-E">IX-E</option>
                            <option value="IX-F">IX-F</option>
                        </optgroup>
                    </select>
                </div>
                <div class="form-group">
                    <label for="semester">Semester: <span class="required">*</span></label>
                    <select id="semester" name="semester" required>
                        <option value="">Pilih Semester</option>
                        <option value="1">Semester Ganjil</option>
                        <option value="2">Semester Genap</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="tahunAjaran">Tahun Ajaran: <span class="required">*</span></label>
                     <select id="tahunAjaran" name="tahunAjaran" required>
                        <option value="">Pilih Tahun Ajaran</option>
                        <option value="2024/2025">2024/2025</option>
                        <option value="2025/2026">2025/2026</option>
                    </select>
                </div>
            </div>
            
            <!-- Perkembangan Akademik -->
            <div class="section">
                <h2 class="section-title"><i class="fas fa-book"></i> Perkembangan Akademik</h2>
                <div class="form-group">
                    <label for="nilai">Nilai Rata-rata: <span class="required">*</span></label>
                    <input type="number" id="nilai" name="nilai" min="0" max="100" step="0.01" placeholder="0.00 - 100.00" required>
                    <p class="input-hint">Masukkan nilai antara 0.00 dan 100.00</p>
                </div>
                <div class="form-group">
                    <label for="tugas">Kualitas Pengerjaan Tugas: <span class="required">*</span></label>
                    <select id="tugas" name="tugas" required>
                        <option value="">Pilih Penilaian</option>
                        <option value="Sangat Baik">Sangat Baik</option>
                        <option value="Baik">Baik</option>
                        <option value="Cukup">Cukup</option>
                        <option value="Perlu Peningkatan">Perlu Peningkatan</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="keaktifan">Tingkat Keaktifan di Kelas: <span class="required">*</span></label>
                    <select id="keaktifan" name="keaktifan" required>
                        <option value="">Pilih Penilaian</option>
                        <option value="Sangat Aktif">Sangat Aktif</option>
                        <option value="Aktif">Aktif</option>
                        <option value="Cukup Aktif">Cukup Aktif</option>
                        <option value="Kurang Aktif">Kurang Aktif</option>
                    </select>
                </div>
            </div>
            
            <!-- Perilaku dan Sikap -->
            <div class="section">
                <h2 class="section-title"><i class="fas fa-users"></i> Perilaku dan Sikap</h2>
                <div class="rating-container">
                    <div class="rating-item">
                        <div class="form-group">
                            <label for="disiplin">Kedisiplinan: <span class="required">*</span></label>
                            <select id="disiplin" name="disiplin" required>
                                <option value="">Pilih Penilaian</option>
                                <option value="Sangat Baik">Sangat Baik</option>
                                <option value="Baik">Baik</option>
                                <option value="Cukup">Cukup</option>
                                <option value="Perlu Peningkatan">Perlu Peningkatan</option>
                            </select>
                        </div>
                    </div>
                    <div class="rating-item">
                        <div class="form-group">
                            <label for="tanggungJawab">Tanggung Jawab: <span class="required">*</span></label>
                            <select id="tanggungJawab" name="tanggungJawab" required>
                                <option value="">Pilih Penilaian</option>
                                <option value="Sangat Baik">Sangat Baik</option>
                                <option value="Baik">Baik</option>
                                <option value="Cukup">Cukup</option>
                                <option value="Perlu Peningkatan">Perlu Peningkatan</option>
                            </select>
                        </div>
                    </div>
                    <div class="rating-item">
                        <div class="form-group">
                            <label for="sopanSantun">Sopan Santun: <span class="required">*</span></label>
                            <select id="sopanSantun" name="sopanSantun" required>
                                <option value="">Pilih Penilaian</option>
                                <option value="Sangat Baik">Sangat Baik</option>
                                <option value="Baik">Baik</option>
                                <option value="Cukup">Cukup</option>
                                <option value="Perlu Peningkatan">Perlu Peningkatan</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Kemampuan Sosial -->
            <div class="section">
                <h2 class="section-title"><i class="fas fa-handshake"></i> Kemampuan Sosial</h2>
                <div class="form-group">
                    <label for="interaksi">Interaksi dengan Teman: <span class="required">*</span></label>
                    <select id="interaksi" name="interaksi" required>
                        <option value="">Pilih Penilaian</option>
                        <option value="Sangat Baik">Sangat Baik - Mudah bergaul dan bekerja sama</option>
                        <option value="Baik">Baik - Dapat bekerja sama dengan baik</option>
                        <option value="Cukup">Cukup - Kadang-kadang perlu bimbingan dalam bekerja sama</option>
                        <option value="Perlu Peningkatan">Perlu Peningkatan - Memerlukan bimbingan dalam interaksi sosial</option>
                    </select>
                </div>
            </div>
            
            <!-- Partisipasi Non-Akademik -->
            <div class="section">
                <h2 class="section-title"><i class="fas fa-futbol"></i> Partisipasi Non-Akademik</h2>
                <div class="form-group">
                    <label>Pilih Ekstrakurikuler: <span class="input-hint">(Bisa memilih lebih dari satu)</span></label>
                    <div class="ekstra-container">
                        <div class="ekstra-item">
                            <input type="checkbox" id="ekstra1" class="ekstra-checkbox" name="ekstrakurikuler" value="Pramuka">
                            <label for="ekstra1" class="ekstra-label">Pramuka</label>
                        </div>
                        
                        <div class="ekstra-item">
                            <input type="checkbox" id="ekstra2" class="ekstra-checkbox" name="ekstrakurikuler" value="PMR">
                            <label for="ekstra2" class="ekstra-label">PMR</label>
                        </div>
                        
                        <div class="ekstra-item">
                            <input type="checkbox" id="ekstra3" class="ekstra-checkbox" name="ekstrakurikuler" value="Basket">
                            <label for="ekstra3" class="ekstra-label">Basket</label>
                        </div>
                        
                        <div class="ekstra-item">
                            <input type="checkbox" id="ekstra4" class="ekstra-checkbox" name="ekstrakurikuler" value="Sepak Bola">
                            <label for="ekstra4" class="ekstra-label">Sepak Bola</label>
                        </div>
                        
                        <div class="ekstra-item">
                            <input type="checkbox" id="ekstra5" class="ekstra-checkbox" name="ekstrakurikuler" value="Voli">
                            <label for="ekstra5" class="ekstra-label">Voli</label>
                        </div>
                        
                        <div class="ekstra-item">
                            <input type="checkbox" id="ekstra6" class="ekstra-checkbox" name="ekstrakurikuler" value="Paduan Suara">
                            <label for="ekstra6" class="ekstra-label">Paduan Suara</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Deskripsi -->
            <div class="section">
                <h2 class="section-title"><i class="fas fa-edit"></i> Deskripsi</h2>
                <div class="form-group">
                    <label for="deskripsi">Deskripsi Umum dan Komentar: <span class="required">*</span></label>
                    <textarea id="deskripsi" name="deskripsi" placeholder="Tuliskan deskripsi umum perkembangan siswa, pencapaian, dan area yang perlu ditingkatkan" required></textarea>
                </div>
            </div>
            
            <div class="btn-container">
                <button type="submit" id="submitButton"><i class="fas fa-save"></i> Simpan Penilaian</button>
            </div>
        </form>
    </div>

    <script>
        // ⚠️ GANTI DENGAN URL WEB APP ANDA ⚠️
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyhMWvFyzNGc_6CDu6pGP3Smq82uhcq4ppot4Dgavu1aobXGqo0h4hAQZa8qa9UTHtk/exec";
        
        document.getElementById('evaluationForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            console.log("Form submission started");
            
            // Sembunyikan pesan sebelumnya
            document.getElementById('successMessage').style.display = 'none';
            document.getElementById('errorMessage').style.display = 'none';
            
            // Validasi sederhana
            const requiredFields = this.querySelectorAll('[required]');
            let isValid = true;
            
            requiredFields.forEach(field => {
                if (!field.value) {
                    isValid = false;
                    field.style.borderColor = '#e74c3c';
                } else {
                    field.style.borderColor = '#ddd';
                }
            });
            
            // Validasi khusus untuk nilai rata-rata
            const nilaiInput = document.getElementById('nilai');
            const nilai = parseFloat(nilaiInput.value);
            
            if (isNaN(nilai) || nilai < 0 || nilai > 100) {
                isValid = false;
                nilaiInput.style.borderColor = '#e74c3c';
                showError('Nilai rata-rata harus berupa angka antara 0 dan 100!');
                return;
            }
            
            if (!isValid) {
                showError('Harap lengkapi semua field yang wajib diisi dengan benar!');
                return;
            }
            
            // Kumpulkan data form
            const formData = new FormData(this);
            const data = {};
            
            // Proses data ekstrakurikuler
            const ekstraChecked = document.querySelectorAll('input[name="ekstrakurikuler"]:checked');
            const ekstrakurikuler = [];
            
            ekstraChecked.forEach(checkbox => {
                ekstrakurikuler.push(checkbox.value);
            });
            
            // Tambahkan data ke objek
            for (let [key, value] of formData.entries()) {
                if (key === 'ekstrakurikuler') {
                    continue;
                }
                data[key] = value;
            }
            
            // Tambahkan data ekstrakurikuler (dipisahkan koma)
            data.ekstrakurikuler = ekstrakurikuler.join(', ');
            
            console.log("Data to be sent:", data);
            
            // Tampilkan loading indicator di tengah halaman
            document.getElementById('loadingIndicator').style.display = 'flex';
            document.getElementById('submitButton').disabled = true;
            
            try {
                // Kirim data ke Google Apps Script
                console.log("Sending data to:", SCRIPT_URL);
                
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                console.log("Response status:", response.status);
                
                // Handle response
                const responseText = await response.text();
                console.log("Raw response:", responseText);
                
                if (!responseText) {
                    throw new Error('Empty response from server');
                }
                
                let result;
                try {
                    result = JSON.parse(responseText);
                } catch (parseError) {
                    console.error('JSON parse error:', parseError);
                    throw new Error('Invalid JSON response from server');
                }
                
                console.log("Parsed response data:", result);
                
                if (result.result === "success") {
                    showSuccess('Penilaian berhasil disimpan! Data tersimpan di spreadsheet.');
                    
                    // Reset form
                    this.reset();
                    
                    // Scroll ke atas
                    window.scrollTo(0, 0);
                    
                } else {
                    throw new Error(result.message || "Unknown error from server");
                }
            } catch (error) {
                console.error('Error details:', error);
                showError('Terjadi kesalahan saat menyimpan data: ' + error.message);
            } finally {
                // Sembunyikan loading indicator
                document.getElementById('loadingIndicator').style.display = 'none';
                document.getElementById('submitButton').disabled = false;
            }
        });
        
        // Fungsi untuk menampilkan pesan sukses
        function showSuccess(message) {
            const successElement = document.getElementById('successMessage');
            document.getElementById('successText').textContent = message;
            successElement.style.display = 'block';
            
            // Auto hide success message after 5 seconds
            setTimeout(() => {
                successElement.style.display = 'none';
            }, 5000);
        }
        
        // Fungsi untuk menampilkan pesan error
        function showError(message) {
            const errorElement = document.getElementById('errorMessage');
            document.getElementById('errorText').textContent = message;
            errorElement.style.display = 'block';
        }
        
        // Test koneksi saat halaman dimuat
        window.addEventListener('load', async function() {
            try {
                console.log("Testing connection to:", SCRIPT_URL);
                const response = await fetch(SCRIPT_URL);
                const responseText = await response.text();
                console.log("Connection test response:", responseText);
                
                let result;
                try {
                    result = JSON.parse(responseText);
                } catch (e) {
                    console.error("Failed to parse test response:", e);
                    return;
                }
                
                console.log("Backend connection test:", result);
            } catch (error) {
                console.error("Backend connection failed:", error);
            }
        });
    </script>
</body>
</html>


